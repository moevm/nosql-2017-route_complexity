<!DOCTYPE html>

<html>

<head>
    <title>Complexity</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style type="text/css" >
        body{
            background: #ffffff;
            margin: 0px;
            font-family: sans-serif;
            height: auto;
            }
            .main_wrapper{
            width: 76%;
            margin: 0% 12%;
            height: 100%;
            background: #ffffff;
            display: inline-block;

            }

            .header_wrapper{
            background: #535363;
            height: auto;
            }
            .header{
                width: 76%;
                margin: 0% 12%;
                padding: 7px 0px;
                display: grid;
            }
            .title{
                float: left;
                font-size: 28pt;
            }
            .nav{
                display: inline-block;
                margin-bottom: 5px;
                float: left;
            }
                .nav ul{
                margin: 0px;
                padding: 0px;
                list-style: none;
                font-size: 12pt;
                }
                .nav li{
                display: inline-block;
                vertical-align: middle;
                padding-right: 5px;
                padding-top: 5px;
                }
                .nav a:link{
                color: #000;
                text-decoration: none;
                }
                .nav a:hover{
                text-decoration: underline;
                }
                .nav a:visited{
                color: #000;
                text-decoration: none;
                }

            .container{
            margin: 5px;
            margin-top: 15px;
            display: grid;
            }

            .map_container{
                display: block;
                width: inherit;
                height: 400px;
            }
                .map_container img{
                max-width: 100%;
                height: auto;
                display: block;
                }
                #map{
                width: 100%;
                height: 100%;
                }

            .form_wrapper{
                width: 99%;
                padding-left: 1%;
                display: inline-block;
            }
                .form{
                display: grid;
                }
                .form input{
                margin-bottom: 5px;
                }
                .form div{
                margin-top: 7px;
                }

            .footer_wrapper{
            background: #0f0f12;
            margin-top: 20px;
            color: #858599;
            }
            .footer{
                display: inline-block;
                width: 76%;
                margin: 0% 12%;
                padding: 1%;
            }

    
    </style>
    
	<style>
        #list {
            padding: 10px;
        }
        
    </style>
</head>

<body>
    <header class='header_wrapper'> 
        <div class='header'> 
            <nav class="nav">
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#">About</a></li>
                </ul>
            </nav>
            <span class="title">Route Complexity</span>
        </div>
    </header>
<div class='main_wrapper'>
       <div class='container'>
       <div class='map_container'>
       <div id='map' ></div>
</div>
 <div id="list"></div>
 
    <form name="adrForm" method="post" action="/path/add">
        <input type="text" id="pA" name = "pointA" ><br>
        <input type="text" id="pB" name = "pointB" ><br>
        <input type="submit" value="Построить новый маршрут">
    </form>    

    <form id="form" method="post" action="/coord/add" >
        <textarea id="idStr" name = "coord_id" hidden="true"></textarea><br>
        <textarea id="xStr" name = "coord_x" hidden="true"></textarea><br>
        <textarea id="yStr" name = "coord_y" hidden="true"></textarea><br>
        <textarea id="strStr" name = "coord_str" hidden="true"></textarea><br>
        <input type="text" id = "pAdiv" name = "pA" size = "40" value = '<%= pointA%>' ><br>
        <input type="text" id = "pBdiv" name = "pB" size = "40" value = '<%= pointB%>' ><br>
        <input type="submit" value="Сложность">
    </form>
    
    <div>Complexity = </div>
    <%= complexity - 1 %> 

    <br><br>
    
 </div>
 <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
 <script src="https://yandex.st/jquery/2.2.3/jquery.min.js" type="text/javascript"></script>
 <script type="text/javascript">
     ymaps.ready(function init() {
        var myMap = new ymaps.Map("map", {
             // center: [X, Y],
             center: [55.745508, 37.435225],
             zoom: 13
         }, {
             searchControlProvider: 'yandex#search'
         });;

         // Добавим на карту схему проезда
         ymaps.route([
              document.getElementById("pAdiv").value,
              document.getElementById("pBdiv").value
         ]).then(function (route) {
             myMap.geoObjects.add(route);
             // Зададим содержание иконок начальной и конечной точкам маршрута.
             // С помощью метода getWayPoints() получаем массив точек маршрута.
             // Массив транзитных точек маршрута можно получить с помощью метода getViaPoints.
             var points = route.getWayPoints(),
                 lastPoint = points.getLength() - 1;
             // Задаем стиль метки - иконки будут красного цвета, и
             // их изображения будут растягиваться под контент.
             points.options.set('preset', 'islands#redStretchyIcon');
             // Задаем контент меток в начальной и конечной точках.
             points.get(0).properties.set('iconContent', 'Точка отправления');
             points.get(lastPoint).properties.set('iconContent', 'Точка прибытия');
             // Проанализируем маршрут по сегментам.
             // Сегмент - участок маршрута, который нужно проехать до следующего
             // изменения направления движения.
             // Для того, чтобы получить сегменты маршрута, сначала необходимо получить
             // отдельно каждый путь маршрута.
             // Весь маршрут делится на два пути:
             // 1) от улицы Крылатские холмы до станции "Кунцевская";
             // 2) от станции "Кунцевская" до "Пионерская".

             var ro = [],
                 counter = 0,
                 way,
                 segments;
             // Получаем массив путей и массив маршрута ro
             A = route.getPaths().get(0).getSegments();
             coordA = A[0].getCoordinates();
             B = route.getPaths().get(route.getPaths().getLength() - 1).getSegments();
             coordB = B[0].getCoordinates(B.length - 1);
             //X = (coordA[0][0] + coordB[0][0]) * 0.5;
             //Y = (coordA[0][1] + coordB[0][1]) * 0.5;

             for (var i = 0; i < route.getPaths().getLength(); i++) {
                 way = route.getPaths().get(i);
                 segments = way.getSegments();
                 for (var j = 0; j < segments.length; j++) {
                     var street = segments[j].getStreet();
                     var coords = segments[j].getCoordinates();
                     if ( coords[0][0] != coordA[0][0] && coords[0][1] != coordA[0][1]
                        || coords[0][0] != coordB[0][0] && coords[0][1] != coordB[0][1] ) {
                            myPlacemark = new ymaps.Placemark([coords[0][0], coords[0][1]], { hintContent: '', balloonContent: '' });
                            myMap.geoObjects.add(myPlacemark);
                        }
                     ro.push({
                         id: counter,
                         x: coords[0][0],
                         y: coords[0][1],
                         str: street
                     })
                     counter = counter+1;
                 }
             }
             var str1='';
             var str2='';
             var str3='';
             var str4='';

             for (var j=0; j<ro.length; j++){
                 str1 = str1+ro[j].id+' ';
                 str2 =str2+ ro[j].x+' ';
                 str3 = str3+ ro[j].y+' ';
                 str4 = str4+ ro[j].str+' , ';
             }
             document.getElementById("idStr").value = str1;
             document.getElementById("xStr").value = str2;
             document.getElementById("yStr").value = str3;
             document.getElementById("strStr").value = str4;
         }, function (error) {
             alert('Возникла ошибка: ' + error.message);
         });
     });
 

 </script>
</body>

</html>

